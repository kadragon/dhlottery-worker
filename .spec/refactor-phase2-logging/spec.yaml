spec_id: SPEC-REFACTOR-P2-LOG-001
title: "Consolidate logging under conditional flag"
priority: medium
phase: 2

given_when_then:
  - given: "console.log() statements are scattered across auth.ts, account.ts, charge.ts, check.ts"
    when: "these logs run in production"
    then: "they add overhead and clutter observability systems"

  - given: "we introduce a DEBUG flag and conditional logging"
    when: "DEBUG is false in production"
    then: "debug/info logs are suppressed, only error logs remain"

acceptance_tests:
  - id: TEST-REFACTOR-P2-LOG-001
    desc: "create DEBUG constant (default: false) in src/constants.ts or env-based"

  - id: TEST-REFACTOR-P2-LOG-002
    desc: "wrap debug/info console.log calls with if (DEBUG) condition"

  - id: TEST-REFACTOR-P2-LOG-003
    desc: "keep error logs unconditional (console.error)"

  - id: TEST-REFACTOR-P2-LOG-004
    desc: "all existing tests should pass (test env can enable DEBUG if needed)"

dependencies:
  - file: "src/dhlottery/auth.ts"
  - file: "src/dhlottery/account.ts"
  - file: "src/dhlottery/charge.ts"
  - file: "src/dhlottery/check.ts"
  - file: "src/constants.ts"
  - governance: "coding-style.md"

linked_tasks:
  - TASK-REFACTOR-P2-002

notes: |
  Affected locations:
    - src/dhlottery/auth.ts: Lines 55-63, 128-137, 142-151, 187-195, 231-237
    - src/dhlottery/account.ts: Lines 39-47, 69-76, 92-107, 145-152, 192-200
    - src/dhlottery/charge.ts: Lines 41-47, 53-60, 83-90
    - src/dhlottery/check.ts: Lines 141-147, 180-186

  Approach:
    1. Add DEBUG constant (can be env-based: DEBUG = env.DEBUG === 'true')
    2. Replace console.log(...) with if (DEBUG) console.log(...)
    3. Keep console.error() unconditional

  Impact: Reduces production log noise
  Effort: 15 minutes
  Risk: Low (logs are non-functional)
