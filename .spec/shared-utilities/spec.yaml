spec_id: SPEC-UTILS-001
title: "Shared Constants and Date Utilities"
version: "1.0.0"
status: "draft"

description: |
  Provide shared business-rule constants and reusable date utilities used across the DHLottery worker.
  This reduces duplication and makes time-zone-sensitive logic (KST week range calculations) consistent.

given_when_then:
  - given: "Business rules are shared across modules (deposit, purchase, etc.)"
    when: "A module needs a common value (e.g., minimum balance, charge amount, purchase costs)"
    then: "It imports from a shared constants module instead of duplicating literals"

  - given: "Winning check relies on KST week boundaries"
    when: "Previous week range is calculated"
    then: "The range is Monday 00:00:00.000 KST to Sunday 23:59:59.999 KST, returned with YYYY-MM-DD strings"

  - given: "Type definitions live under src/types"
    when: "A consumer needs multiple shared types"
    then: "It can import from a single barrel file without changing runtime behavior"

acceptance_tests:
  - id: TEST-UTILS-001
    desc: "Should calculate previous week range in KST"
    criteria:
      - "Given a known KST date, returns previous Mon~Sun range"
      - "Returns YYYY-MM-DD strings for start/end"
      - "Throws DHLotteryError for invalid Date"

  - id: TEST-UTILS-002
    desc: "Should expose shared business constants"
    criteria:
      - "Exports MIN_DEPOSIT_AMOUNT and CHARGE_AMOUNT"
      - "Exports purchase-related constants (game count, cost per game, total cost)"

  - id: TEST-UTILS-003
    desc: "Should provide a types barrel export"
    criteria:
      - "src/types/index.ts re-exports existing public types"
      - "No runtime side effects (types-only exports where possible)"

dependencies:
  governance: "parsing-pattern"
  specs:
    - SPEC-DEPOSIT-001
    - SPEC-PURCHASE-001
    - SPEC-WINNING-001

linked_tasks:
  - TASK-010

implementation_notes:
  - "Keep backward compatibility for existing exports where feasible."
  - "Prefer numeric constants in src/constants.ts; re-export in type modules only if needed."
