spec_id: SPEC-REFACTOR-P2-REGEX-001
title: "Extract regex patterns to named constants"
priority: medium
phase: 2

given_when_then:
  - given: "regex patterns in account.ts and check.ts are hardcoded inline"
    when: "patterns need to be tested, modified, or understood"
    then: "it's difficult because they lack descriptive names and are scattered"

  - given: "we extract patterns to named constants with clear names"
    when: "developers need to understand or modify parsing logic"
    then: "patterns are self-documenting and easier to maintain"

acceptance_tests:
  - id: TEST-REFACTOR-P2-REGEX-001
    desc: "balance parsing patterns should be extracted to BALANCE_PATTERNS constant object"

  - id: TEST-REFACTOR-P2-REGEX-002
    desc: "round parsing patterns should be extracted if applicable"

  - id: TEST-REFACTOR-P2-REGEX-003
    desc: "winning result patterns should be extracted to WINNING_PATTERNS constant object"

  - id: TEST-REFACTOR-P2-REGEX-004
    desc: "all existing parsing tests should pass after extraction"

  - id: TEST-REFACTOR-P2-REGEX-005
    desc: "pattern constants should use 'as const' for type safety"

dependencies:
  - file: "src/dhlottery/account.ts"
  - file: "src/dhlottery/check.ts"
  - governance: "coding-style.md"
  - governance: "patterns.md"

linked_tasks:
  - TASK-REFACTOR-P2-001

notes: |
  Locations:
    - src/dhlottery/account.ts:123-133 (balance patterns)
    - src/dhlottery/check.ts:67-68 (winning patterns)

  Example structure:
    const BALANCE_PATTERNS = {
      MAIN_PAGE_HEADER: /<li[^>]*class="money"[^>]*>[\s\S]*?<strong>([\d,]+)<\/strong>/i,
      TABLE_CELL: /<td[^>]*class="ta_right"[^>]*>\s*([\d,]+)\s+/i,
      SUFFIX_FORMAT: /<strong>([\d,]+)<\/strong>\s*Ïõê/,
    } as const;

  Impact: Improves maintainability and testability
  Effort: 15 minutes
  Risk: Low (pure refactoring)
