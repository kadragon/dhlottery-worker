spec_id: SPEC-REFACTOR-P1-ERROR-001
title: "Add PurchaseError class for consistent error handling"
priority: medium
phase: 1

given_when_then:
  - given: "buy.ts and charge.ts use generic Error class with status code only"
    when: "purchase operations fail"
    then: "error messages lack context and specific error codes"

  - given: "auth.ts uses specific AuthenticationError with error codes"
    when: "we add PurchaseError class following the same pattern"
    then: "purchase errors become consistently classified and easier to debug"

acceptance_tests:
  - id: TEST-REFACTOR-P1-ERROR-001
    desc: "PurchaseError class should be created in src/utils/errors.ts"

  - id: TEST-REFACTOR-P1-ERROR-002
    desc: "PurchaseError should extend DHLotteryError with name='PurchaseError'"

  - id: TEST-REFACTOR-P1-ERROR-003
    desc: "PurchaseError should support custom error codes (default: PURCHASE_ERROR)"

  - id: TEST-REFACTOR-P1-ERROR-004
    desc: "existing error handling tests should pass"

dependencies:
  - file: "src/utils/errors.ts"
  - spec: "SPEC-REFACTOR-P2-ERROR-001"
  - governance: "patterns.md"

linked_tasks:
  - TASK-REFACTOR-P1-003

notes: |
  Location: src/utils/errors.ts (new class)
  Impact: Improves error classification and debugging
  Effort: 10 minutes
  Risk: None (backward compatible addition)

  Will be used by TASK-REFACTOR-P2-004 to update buy.ts error handling
